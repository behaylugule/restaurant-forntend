(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9777],{405:(e,t,r)=>{"use strict";r.d(t,{W:()=>s});var a=r(2115);function s(){let e=[10,20,30,40,50],[t,r]=(0,a.useState)(1),[s,n]=(0,a.useState)(""),[o,l]=(0,a.useState)(0),[c,i]=(0,a.useState)(e[0]||10),u=(0,a.useMemo)(()=>0===c?0:Math.ceil(o/c),[o,c]);return{page:t,totalCount:o,setPage:r,setTotalCount:l,handleNextPage:()=>{t<u&&r(e=>e+1)},handlePrevPage:()=>{t>1&&r(e=>e-1)},page_sizes:e,pageSize:c,setPageSize:i,totalPages:u,search:s,setSearch:n}}},1059:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var a=r(5155),s=r(9550),n=r(2115),o=r(5695),l=r(405),c=r(7764),i=r(9946);let u=(0,i.A)("user-round-check",[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]);function d(e){let{setChatRoomDetail:t}=e,r=(0,l.W)(),[s,o]=(0,n.useState)([]);return(0,n.useEffect)(()=>{c.O.getChatRooms({page:r.page,page_size:r.pageSize,search:r.search}).then(e=>{console.log(e.data),o(e.data.data.results),r.setTotalCount(e.data.data.results)}).catch(e=>{console.log(e)})},[]),(0,a.jsxs)("div",{className:"w-full flex flex-col items-start",children:[(0,a.jsx)("div",{children:(0,a.jsx)("h1",{className:"text-gray-700 font-semibold",children:"Customers"})}),(0,a.jsx)("div",{className:"w-full flex flex-col items-center  mt-4 gap-4 ",children:s.map((e,r)=>(0,a.jsxs)("button",{className:"flex items-center justify-start gap-3 cursor-pointer bg-[#E3E3E3] rounded-lg px-4 py-2 w-full",onClick:()=>t(e),children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-10 h-10 border-2 border-gray-600 rounded-full ",children:(0,a.jsx)(u,{size:25})}),(0,a.jsx)("h1",{className:"text-[16px] font-meduim text-gray-600",children:e.client_name})]},r))})]})}var m=r(3999),h=r(5765);let f=(0,i.A)("message-circle-code",[["path",{d:"M10 9.5 8 12l2 2.5",key:"3mjy60"}],["path",{d:"m14 9.5 2 2.5-2 2.5",key:"1bir2l"}],["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22z",key:"k85zhp"}]]);function p(e){let{chatRoomDetail:t}=e,[r,o]=(0,n.useState)([]),[i,u]=(0,n.useState)(""),d=(0,l.W)(),{user:p}=(0,s.A)(),x=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(!(null==t?void 0:t.id))return;let e=localStorage.getItem("access");return x.current=new WebSocket("ws://localhost:8000/ws/chat/".concat(t.id,"/?token=").concat(e)),x.current.onmessage=e=>{let t=JSON.parse(e.data);t.create_date=Date.now(),o(e=>[...e,t]),u("")},()=>{x.current&&x.current.close()}},[null==t?void 0:t.id]);let g=()=>{x.current&&i.trim()&&x.current.readyState==WebSocket.OPEN&&x.current.send(JSON.stringify({sender:h.Mx.SYSTEM,username:p.username,text:i}))};return(0,n.useEffect)(()=>{(null==t?void 0:t.shop)&&c.O.getMessages({page:d.page,search:d.search,page_size:100,room_id:t.id}).then(e=>{o(e.data.data.results)}).catch(e=>{console.log(e)})},[d.page,null==t?void 0:t.id]),(0,a.jsx)("div",{className:"relative min-h-96 max-h-[80vh]",children:(null==t?void 0:t.id)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute top-0 w-full py-3 border-b-2 border-gray-300 bg-white text-center font-medium text-[20px]",children:(0,a.jsx)("h1",{children:null==t?void 0:t.client_name})}),(0,a.jsx)("div",{className:"overflow-y-scroll  border p-4 rounded bg-gray-100 mb-4 py-16  h-[70vh]",children:r.map((e,t)=>(0,a.jsx)("div",{className:"You"===e.sender?"text-right":"text-left",children:(0,a.jsxs)("div",{className:"flex flex-col  px-3 py-2  rounded  shadow mb-2 ".concat(e.sender==h.Mx.SYSTEM?"items-end bg-[#C71F37]/10":"items-start"),children:[(0,a.jsx)("span",{className:"font-normal text-[16px] ".concat(e.sender==h.Mx.SYSTEM?"text-right":"text-left"),children:e.text}),(0,a.jsx)("span",{className:"font-normal text-gray-400 ".concat(e.sender==h.Mx.SYSTEM?"text-left":"text-right"),children:(0,m.f)(e.create_date||"")})]})},t))}),(0,a.jsxs)("div",{className:"absolute bottom-0 flex gap-2 w-full",children:[(0,a.jsx)("input",{className:"flex-1 border-2 p-2 py-4 rounded border-[#C71F37] bg-white outline-none",value:i,onChange:e=>u(e.target.value),onKeyDown:e=>"Enter"===e.key&&g()}),(0,a.jsx)("button",{className:"bg-[#C71F37] text-white px-4 rounded",onClick:g,children:"Send"})]})]}):(0,a.jsxs)("div",{className:"w-full h-[70vh] flex flex-col items-center justify-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gray-300 flex items-center justify-center rounded-full",children:(0,a.jsx)(f,{})}),(0,a.jsxs)("div",{className:"w-full text-center ",children:[(0,a.jsx)("h1",{className:"text-[20px] font-medium text-gray-700 mb-3",children:"Select a conversation"}),(0,a.jsx)("p",{className:"text-[14px] font-normal text-gray-700",children:"Choose a user from the list to start chatting"})]})]})})}function x(){let{isAuthenticated:e}=(0,s.A)(),t=(0,o.useRouter)(),[r,c]=(0,n.useState)(),i=(0,l.W)();return(0,n.useEffect)(()=>{e||t.push("/login")},[e]),(0,n.useEffect)(()=>{},[i.page,i.search]),(0,a.jsxs)("div",{className:"w-full ",children:[(0,a.jsx)("div",{className:"flex justify-between items-center px-2 lg:px-12 py-4",children:(0,a.jsx)("h1",{className:"text-[30px] text-gray-700 font-medium",children:"Chats"})}),(0,a.jsx)("div",{className:"w-full flex items-start justify-center h-full ",children:(0,a.jsxs)("div",{className:"flex items-start justify-center w-6xl bg-white min-h-96 rounded-lg px-5 py-16 gap-3",children:[(0,a.jsx)("div",{className:"flex-1/4 px-3  h-full",children:(0,a.jsx)(d,{setChatRoomDetail:c})}),(0,a.jsx)("div",{className:"flex-3/4  ",children:(0,a.jsx)(p,{chatRoomDetail:r})})]})})]})}},2107:(e,t,r)=>{"use strict";r.d(t,{D:()=>s});var a=r(5784);let s={registerUser:function(e){return a.A.post("/register/",e)},login:n,logout:m,getCurrentUser:o,changePassword:l,getUsers:c,forgetPassword:i,resetPassword:u,updateProfile:d};async function n(e){return await a.A.post("/token/",e)}async function o(){return await a.A.get("/me/")}async function l(e){return await a.A.put("/change-password/",e)}async function c(e){return await a.A.get("/users/",{params:{...e}})}async function i(e){return await a.A.post("/password-reset/",{email:e})}async function u(e){return await a.A.post("/password-reset/confirm/?token=".concat(e.token),e)}async function d(e){return await a.A.patch("/update-profile/".concat(e.id,"/"),e)}async function m(){localStorage.removeItem("access"),localStorage.removeItem("refresh"),window.location.href="/login"}},2454:(e,t,r)=>{Promise.resolve().then(r.bind(r,1059))},3999:(e,t,r)=>{"use strict";r.d(t,{D:()=>c,cn:()=>o,f:()=>l});var a=r(2596),s=r(3319),n=r(9688);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.QP)((0,a.$)(t))}function l(e){let t=new Date;e=new Date(e);let r=t.getTime()-e.getTime(),a=Math.floor(r/1e3),s=Math.floor(r/6e4),n=Math.floor(r/36e5),o=Math.floor(r/864e5),l=new Intl.RelativeTimeFormat("en",{numeric:"auto"});return a<60?l.format(-a,"second"):s<60?l.format(-s,"minute"):n<24?l.format(-n,"hour"):l.format(-o,"day")}function c(e){return(0,s.GP)(e,"HH:mm a")}},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},5765:(e,t,r)=>{"use strict";r.d(t,{Hc:()=>o,Mx:()=>n,tX:()=>a,w8:()=>s});var a=function(e){return e.ADMIN="admin",e.ORGANIZATION_ADMIN="organization_admin",e.SHOP_ADMIN="shop_admin",e.CUSTOMER="customer",e.USER="user",e}({}),s=function(e){return e.PENDING="pending",e.PROCESSING="processing",e.READY="ready",e.COMPLETED="completed",e.CANCLED="cancled",e}({}),n=function(e){return e.USER="user",e.SYSTEM="system",e}({});let o="https://restaurantsaasmenuimage.s3.amazonaws.com"},5784:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(3464),s=r(3568);let n="http://localhost:8000/api",o=a.A.create({baseURL:n});o.interceptors.request.use(e=>{console.log("base URL",n);{let t=localStorage.getItem("access");t&&(e.headers.Authorization="Bearer ".concat(t))}return"post"!==e.method&&"put"!==e.method&&"patch"!==e.method||e.headers["Content-Type"]||(e.headers["Content-Type"]="application/json"),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,async e=>{var t,r,o;let l=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!l._retry){l._retry=!0;try{localStorage.getItem("refresh");let e=await a.A.post(n+"/token/refresh");localStorage.setItem("access",e.data.access),l.headers.Authorization="Bearer ".concat(e.data.access)}catch(e){localStorage.removeItem("access"),localStorage.removeItem("refresh"),window.location.href="/login"}}return console.log("Error response:",e.response),s.Ay.error((null==(o=e.response)||null==(r=o.data)?void 0:r.message)||"An error occurred"),Promise.reject(e)});let l=o},7764:(e,t,r)=>{"use strict";r.d(t,{O:()=>s});var a=r(5784);let s={getMessages:n,getChatRooms:o};async function n(e){return a.A.get("/messages/",{params:{...e}})}async function o(e){return a.A.get("/chat-rooms/",{params:{...e}})}},9550:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,AuthProvider:()=>c});var a=r(5155),s=r(2115),n=r(2107),o=r(3568);let l=(0,s.createContext)(void 0),c=e=>{let{children:t}=e,[r,c]=(0,s.useState)(null),[i,u]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=localStorage.getItem("access");e&&(c(e),n.D.getCurrentUser().then(e=>{u(e.data.data)}).catch(e=>{console.error("Failed to fetch current user:",e),u(null)}))},[]),(0,a.jsx)(l.Provider,{value:{user:i,accessToken:r,isAuthenticated:!!r,login:e=>{c(e),n.D.getCurrentUser().then(e=>{u(e.data.data)}).catch(e=>{o.Ay.error("failed to fetch current user")})},logout:()=>{localStorage.removeItem("access"),c(null),u(null)}},children:t})},i=()=>{let e=(0,s.useContext)(l);if(void 0==e)throw Error("useAuth must be used within an Authprovider");return e}},9946:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(2115);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:c,className:i="",children:u,iconNode:d,...m}=e;return(0,a.createElement)("svg",{ref:t,...o,width:s,height:s,stroke:r,strokeWidth:c?24*Number(l)/Number(s):l,className:n("lucide",i),...!u&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...d.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),c=(e,t)=>{let r=(0,a.forwardRef)((r,o)=>{let{className:c,...i}=r;return(0,a.createElement)(l,{ref:o,iconNode:t,className:n("lucide-".concat(s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),c),...i})});return r.displayName=s(e),r}}},e=>{e.O(0,[7567,397,8441,5964,7358],()=>e(e.s=2454)),_N_E=e.O()}]);