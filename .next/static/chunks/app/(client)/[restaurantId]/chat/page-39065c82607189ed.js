(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4127],{405:(e,t,a)=>{"use strict";a.d(t,{W:()=>s});var r=a(2115);function s(){let e=[10,20,30,40,50],[t,a]=(0,r.useState)(1),[s,n]=(0,r.useState)(""),[o,c]=(0,r.useState)(0),[u,l]=(0,r.useState)(e[0]||10),i=(0,r.useMemo)(()=>0===u?0:Math.ceil(o/u),[o,u]);return{page:t,totalCount:o,setPage:a,setTotalCount:c,handleNextPage:()=>{t<i&&a(e=>e+1)},handlePrevPage:()=>{t>1&&a(e=>e-1)},page_sizes:e,pageSize:u,setPageSize:l,totalPages:i,search:s,setSearch:n}}},495:(e,t,a)=>{"use strict";a.d(t,{S:()=>s});var r=a(5784);let s={getShops:n,getShop:o,addShop:c,updateShop:u,deleteShop:l,getShopsForClient:i};async function n(e){return await r.A.get("/shops/",{params:{...e}})}async function o(e){return await r.A.get("/shops/".concat(e,"/"))}async function c(e){return await r.A.post("/shops/",e)}async function u(e){return await r.A.patch("/shops/".concat(e.id,"/"),e)}async function l(e){return await r.A.delete("/shops/".concat(e,"/"))}async function i(e){let{page:t,page_size:a,search:s}=e;return await r.A.get("/client/shops/",{params:{page:t,page_size:a,search:s}})}},2107:(e,t,a)=>{"use strict";a.d(t,{D:()=>s});var r=a(5784);let s={registerUser:function(e){return r.A.post("/register/",e)},login:n,logout:h,getCurrentUser:o,changePassword:c,getUsers:u,forgetPassword:l,resetPassword:i,updateProfile:d};async function n(e){return await r.A.post("/token/",e)}async function o(){return await r.A.get("/me/")}async function c(e){return await r.A.put("/change-password/",e)}async function u(e){return await r.A.get("/users/",{params:{...e}})}async function l(e){return await r.A.post("/password-reset/",{email:e})}async function i(e){return await r.A.post("/password-reset/confirm/?token=".concat(e.token),e)}async function d(e){return await r.A.patch("/update-profile/".concat(e.id,"/"),e)}async function h(){localStorage.removeItem("access"),localStorage.removeItem("refresh"),window.location.href="/login"}},3258:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var r=a(5155),s=a(2115),n=a(5695),o=a(7764),c=a(405),u=a(495),l=a(9550),i=a(5765),d=a(3999);function h(){let e=(0,n.useParams)().restaurantId,[t,a]=(0,s.useState)([]),[h,m]=(0,s.useState)(""),f=(0,c.W)(),[g,p]=(0,s.useState)(),[S,w]=(0,s.useState)(),{user:v}=(0,l.A)(),x=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!(null==S?void 0:S.id))return;let e=localStorage.getItem("access");return x.current=new WebSocket("ws://localhost:8000/ws/chat/".concat(S.id,"/?token=").concat(e)),console.log(x.current),x.current.onmessage=e=>{let t=JSON.parse(e.data);console.log(t),t.create_date=Date.now(),a(e=>[...e,t])},()=>{x.current&&x.current.close()}},[S]);let y=()=>{console.log(x.current),x.current&&h.trim()&&x.current.readyState==WebSocket.OPEN&&x.current.send(JSON.stringify({sender:i.Mx.USER,username:v.username,text:h}))};(0,s.useEffect)(()=>{(null==S?void 0:S.id)&&o.O.getMessages({page:f.page,search:f.search,page_size:100,room_id:S.id}).then(e=>{a(e.data.data.results)}).catch(e=>{console.log(e)})},[f.page,null==S?void 0:S.id]);let A=(0,c.W)();return(0,s.useEffect)(()=>{e&&o.O.getChatRooms({page:A.page,page_size:A.pageSize,search:A.search,shop_id:e.toLocaleString()}).then(e=>{w(e.data.data.results[0]),console.log(e.data.data.results[0])}).catch(e=>{console.log(e)}),e&&u.S.getShop(e.toLocaleString()).then(e=>{p(e.data.data)}).catch(e=>{})},[]),(0,r.jsxs)("div",{className:" relative",children:[(0,r.jsx)("div",{className:"w-full fixed top-0 bg-[#C71F37] py-4 flex items-center justify-center text-white z-50",children:(0,r.jsxs)("h1",{className:"font-medium text-[14px]",children:["Chat with ",null==g?void 0:g.name," Manager"]})}),(0,r.jsx)("div",{className:"overflow-y-scroll  border p-4 pb-36 rounded bg-gray-100 mb-4 ",children:t.map((e,t)=>(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"flex flex-col  px-3 py-2  rounded  shadow mb-2 ".concat(e.sender==i.Mx.USER?"items-end bg-[#C71F37]/10":"items-start"),children:[(0,r.jsx)("span",{className:"font-normal text-[16px] ".concat(e.sender==i.Mx.USER?"text-right":"text-left"),children:e.text}),(0,r.jsx)("span",{className:"font-normal text-gray-400 ".concat(e.sender==i.Mx.USER?"text-right":"text-left"),children:(0,d.f)(e.create_date||"")})]})},t))}),(0,r.jsxs)("div",{className:"fixed bottom-28 flex gap-2 w-full",children:[(0,r.jsx)("input",{className:"flex-1 border-2 p-2 py-4 rounded border-[#C71F37] bg-white outline-none",value:h,onChange:e=>m(e.target.value),onKeyDown:e=>"Enter"===e.key&&y()}),(0,r.jsx)("button",{className:"bg-[#C71F37] text-white px-4 rounded",onClick:y,children:"Send"})]})]})}},3999:(e,t,a)=>{"use strict";a.d(t,{D:()=>u,cn:()=>o,f:()=>c});var r=a(2596),s=a(3319),n=a(9688);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.QP)((0,r.$)(t))}function c(e){let t=new Date;e=new Date(e);let a=t.getTime()-e.getTime(),r=Math.floor(a/1e3),s=Math.floor(a/6e4),n=Math.floor(a/36e5),o=Math.floor(a/864e5),c=new Intl.RelativeTimeFormat("en",{numeric:"auto"});return r<60?c.format(-r,"second"):s<60?c.format(-s,"minute"):n<24?c.format(-n,"hour"):c.format(-o,"day")}function u(e){return(0,s.GP)(e,"HH:mm a")}},4134:(e,t,a)=>{Promise.resolve().then(a.bind(a,3258))},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},5765:(e,t,a)=>{"use strict";a.d(t,{Hc:()=>o,Mx:()=>n,tX:()=>r,w8:()=>s});var r=function(e){return e.ADMIN="admin",e.ORGANIZATION_ADMIN="organization_admin",e.SHOP_ADMIN="shop_admin",e.CUSTOMER="customer",e.USER="user",e}({}),s=function(e){return e.PENDING="pending",e.PROCESSING="processing",e.READY="ready",e.COMPLETED="completed",e.CANCLED="cancled",e}({}),n=function(e){return e.USER="user",e.SYSTEM="system",e}({});let o="https://restaurantsaasmenuimage.s3.amazonaws.com"},5784:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(3464),s=a(3568);let n="http://localhost:8000/api",o=r.A.create({baseURL:n});o.interceptors.request.use(e=>{console.log("base URL",n);{let t=localStorage.getItem("access");t&&(e.headers.Authorization="Bearer ".concat(t))}return"post"!==e.method&&"put"!==e.method&&"patch"!==e.method||e.headers["Content-Type"]||(e.headers["Content-Type"]="application/json"),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,async e=>{var t,a,o;let c=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!c._retry){c._retry=!0;try{localStorage.getItem("refresh");let e=await r.A.post(n+"/token/refresh");localStorage.setItem("access",e.data.access),c.headers.Authorization="Bearer ".concat(e.data.access)}catch(e){localStorage.removeItem("access"),localStorage.removeItem("refresh"),window.location.href="/login"}}return console.log("Error response:",e.response),s.Ay.error((null==(o=e.response)||null==(a=o.data)?void 0:a.message)||"An error occurred"),Promise.reject(e)});let c=o},7764:(e,t,a)=>{"use strict";a.d(t,{O:()=>s});var r=a(5784);let s={getMessages:n,getChatRooms:o};async function n(e){return r.A.get("/messages/",{params:{...e}})}async function o(e){return r.A.get("/chat-rooms/",{params:{...e}})}},9550:(e,t,a)=>{"use strict";a.d(t,{A:()=>l,AuthProvider:()=>u});var r=a(5155),s=a(2115),n=a(2107),o=a(3568);let c=(0,s.createContext)(void 0),u=e=>{let{children:t}=e,[a,u]=(0,s.useState)(null),[l,i]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=localStorage.getItem("access");e&&(u(e),n.D.getCurrentUser().then(e=>{i(e.data.data)}).catch(e=>{console.error("Failed to fetch current user:",e),i(null)}))},[]),(0,r.jsx)(c.Provider,{value:{user:l,accessToken:a,isAuthenticated:!!a,login:e=>{u(e),n.D.getCurrentUser().then(e=>{i(e.data.data)}).catch(e=>{o.Ay.error("failed to fetch current user")})},logout:()=>{localStorage.removeItem("access"),u(null),i(null)}},children:t})},l=()=>{let e=(0,s.useContext)(c);if(void 0==e)throw Error("useAuth must be used within an Authprovider");return e}}},e=>{e.O(0,[7567,397,8441,5964,7358],()=>e(e.s=4134)),_N_E=e.O()}]);